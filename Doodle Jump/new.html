<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Moving Rectangle with Jump and Falling Platforms</title>
    <style>
      canvas {
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <canvas id="gameCanvas" width="600" height="600"></canvas>
    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      const player = {
        x: canvas.width / 2 - 20,
        y: canvas.height - 30,
        width: 40,
        height: 20,
        speed: 5,
        jumpStrength: 7,
        velocityX: 0,
        velocityY: 0,
        friction: 1,
        gravity: 0.2,
      };

      const platforms = [];
      const platformFrequency = 50; // Increase for more frequent platforms
      const platformSpeed = 1; // Decrease for slower platforms

      function drawPlayer() {
        ctx.fillStyle = "#00F";
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }

      function drawPlatforms() {
        ctx.fillStyle = "#0F0";
        platforms.forEach((platform) => {
          ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
        });
      }

      function update() {
        player.x += player.velocityX;
        player.y += player.velocityY;

        player.velocityX *= player.friction;
        player.velocityY += player.gravity;

        if (player.x < 0) {
          player.x = 0;
          player.velocityX = 0;
        } else if (player.x + player.width > canvas.width) {
          player.x = canvas.width - player.width;
          player.velocityX = 0;
        }

        if (player.y < 0) {
          player.y = 0;
          player.velocityY = 0;
        } else if (player.y + player.height > canvas.height) {
          player.y = canvas.height - player.height;
          player.velocityY = 0;
        }
      }

      function jump() {
        if (player.y === canvas.height - player.height) {
          player.velocityY = -player.jumpStrength;
        }
      }

      function createPlatform() {
        const platform = {
          x: Math.random() * (canvas.width - 40),
          y: 0,
          width: 40,
          height: 10,
          speed: platformSpeed,
        };
        platforms.push(platform);
      }

      function updatePlatforms() {
        platforms.forEach((platform) => {
          platform.y += platform.speed;
          if (platform.y > canvas.height) {
            // Reset platform position if it goes below the canvas
            platform.y = 0;
            platform.x = Math.random() * (canvas.width - 40);
          }

          if (
            player.x < platform.x + platform.width &&
            player.x + player.width > platform.x &&
            player.y + player.height > platform.y &&
            player.y < platform.y + platform.height
          ) {
            // The player is standing on the platform
            player.y = platform.y - player.height;
            player.velocityY = platform.speed; // Set player's velocity to the platform's speed
          }
        });
      }
      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawPlayer();
        // drawPlatforms();
        update();
        // updatePlatforms();

        // Create platforms more frequently
        if (Math.random() < 1 / platformFrequency) {
          createPlatform();
        }

        requestAnimationFrame(gameLoop);
      }

      function keyDownHandler(e) {
        if (e.key === "Right" || e.key === "ArrowRight") {
          player.velocityX = player.speed;
        } else if (e.key === "Left" || e.key === "ArrowLeft") {
          player.velocityX = -player.speed;
        } else if (e.key === "Up" || e.key === "ArrowUp") {
          jump();
        }
      }

      function keyUpHandler(e) {
        if (
          e.key === "Right" ||
          e.key === "ArrowRight" ||
          e.key === "Left" ||
          e.key === "ArrowLeft"
        ) {
          player.velocityX = 0;
        }
      }

      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);

      gameLoop();
    </script>
  </body>
</html>